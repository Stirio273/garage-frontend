<div class="surface-ground p-4">
    <p-toast></p-toast>

    <div class="grid">
        <div class="col-12">
            <p-card class="shadow-2">
                <div class="flex align-items-center justify-content-between mb-4">
                    <div>
                        <h1 class="text-2xl font-bold m-0">Demander un devis</h1>
                        <p class="text-500 mt-2">Sélectionnez les services pour votre véhicule et soumettez une demande
                            de devis</p>
                    </div>
                    <div class="text-right">
                        <h2 class="text-xl font-bold m-0 text-primary">Total: {{getTotalPrice() | number:'1.0-0'}} MGA
                        </h2>
                        <p class="text-500 mt-2">{{getSelectedServices().length}} services sélectionnés</p>
                    </div>
                </div>

                <!-- Car Selection -->
                <div class="mb-4">
                    <label class="block text-900 font-medium mb-2">Sélectionner un véhicule</label>
                    <p-dropdown [options]="cars" [(ngModel)]="selectedCar" optionLabel="marque" [showClear]="true"
                        placeholder="Choisir un véhicule" class="w-full">
                        <ng-template pTemplate="item" let-car>
                            <div class="flex align-items-center">
                                <i class="pi pi-car mr-2"></i>
                                <div>
                                    <div class="font-medium">{{car.marque}} {{car.modele}}</div>
                                    <div class="text-sm text-500">{{car.annee}} - {{car.plaqueImmatriculation}}</div>
                                </div>
                            </div>
                        </ng-template>
                        <ng-template pTemplate="selectedItem" let-car>
                            <div class="flex align-items-center">
                                <i class="pi pi-car mr-2"></i>
                                <div>
                                    <div class="font-medium">{{car.marque}} {{car.modele}}</div>
                                    <div class="text-sm text-500">{{car.annee}} - {{car.plaqueImmatriculation}}</div>
                                </div>
                            </div>
                        </ng-template>
                    </p-dropdown>
                </div>

                <!-- Services Table -->
                <div class="mb-4">
                    <label class="block text-900 font-medium mb-2">Sélectionner les services</label>
                    <p-table [value]="services" [scrollable]="true" scrollHeight="400px"
                        [tableStyle]="{'min-width': '50rem'}" class="p-datatable-striped">
                        <ng-template pTemplate="header">
                            <tr>
                                <th style="width: 4rem"></th>
                                <th>Service</th>
                                <th>Description</th>
                                <th>Durée</th>
                                <th>Prix</th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-service>
                            <tr>
                                <td>
                                    <p-checkbox [binary]="true" [(ngModel)]="service.selected"
                                        (onClick)="onServiceSelect(service)"></p-checkbox>
                                </td>
                                <td>
                                    <div class="font-medium">{{service.name}}</div>
                                </td>
                                <td>
                                    <div class="text-500">{{service.description}}</div>
                                </td>
                                <td>
                                    <div class="text-500">{{service.duration}}</div>
                                </td>
                                <td>
                                    <div class="font-medium">{{service.price | number:'1.0-0'}} MGA</div>
                                </td>
                            </tr>
                        </ng-template>
                    </p-table>
                </div>

                <!-- Additional Notes -->
                <div class="mb-4">
                    <label class="block text-900 font-medium mb-2">Notes supplémentaires</label>
                    <textarea pInputTextarea [(ngModel)]="additionalNotes" [rows]="3"
                        placeholder="Ajoutez des notes supplémentaires ou des remarques ici..."
                        class="w-full"></textarea>
                </div>

                <!-- Submit Button -->
                <div class="flex justify-content-end">
                    <p-button icon="pi pi-send" label="Envoyer la demande" (onClick)="onSubmit()" [loading]="false"
                        styleClass="p-button-raised"></p-button>
                </div>
            </p-card>
        </div>
    </div>
</div>